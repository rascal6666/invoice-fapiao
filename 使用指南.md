# 发票识别器使用指南

## 快速开始

### 1. 运行程序

**方法一：GUI界面（推荐）**
```bash
python gui_app.py
```

**方法二：双击批处理文件**
```
双击 run_gui.bat
```

**方法三：可执行文件**
```
双击 dist/发票识别器.exe
```

### 2. 使用步骤

1. **配置API密钥**：在"API密钥配置"区域输入DeepSeek API密钥并保存
2. **选择目录**：点击"选择目录"按钮，选择包含PDF发票文件的文件夹
3. **开始处理**：点击"开始处理"按钮，程序会自动处理所有PDF文件
4. **查看进度**：通过进度条和日志了解处理状态
5. **获取结果**：处理完成后，Excel文件会保存在选择的目录中

## 界面说明

### API密钥配置区域
- **API密钥输入框**：输入DeepSeek API密钥（以"sk-"开头）
- **显示/隐藏按钮**：切换密钥的显示状态
- **保存密钥按钮**：保存并加密存储API密钥
- **状态显示**：显示API密钥配置状态（✅ 已配置 / ⚠️ 未配置）
- **申请指南按钮**：点击查看详细的API密钥申请步骤

### 使用说明区域
- 📋 **功能说明**：程序的主要功能和特点
- ⚠️ **重要提醒**：使用注意事项和限制
- 📁 **使用步骤**：详细的操作步骤
- 💡 **提示**：使用技巧和建议

### API密钥申请按钮
- **位置**：API密钥配置区域下方
- **功能**：打开API密钥申请指南窗口
- **内容**：包含完整的申请步骤、安全提醒和费用说明
- **操作**：点击后弹出详细指南，可直接打开官网

### 控制按钮
- **选择目录**：选择包含PDF文件的文件夹
- **开始处理**：开始批量处理PDF文件
- **清空日志**：清除日志显示区域的内容

### 进度显示
- **进度条**：显示整体处理进度
- **当前文件**：显示正在处理的文件名

### 处理日志
- **实时日志**：显示详细的处理信息
- **时间戳**：每条日志都包含时间信息
- **状态标识**：✅ 成功，❌ 失败

## 输出文件

### Excel文件
- **文件名**：`发票数据汇总_YYYYMMDD_HHMMSS.xlsx`
- **位置**：与PDF文件在同一目录
- **内容**：包含28个字段的发票数据表格
- **时间戳**：文件名包含生成时间，方便区分不同批次的处理结果

### 缓存文件
- **文件名**：`cache_res_原文件名.json`
- **位置**：与PDF文件在同一目录
- **作用**：避免重复调用AI，节省费用

### 配置文件
- **位置**：`~/.invoice_recognizer/api_config.json`
- **内容**：加密存储的API密钥配置
- **安全**：使用base64编码，避免明文存储

## API密钥配置

### 获取API密钥
1. 访问 [DeepSeek官网](https://platform.deepseek.com/)
2. 注册账号并登录
3. 在控制台获取API密钥
4. 密钥格式：`sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`

### 配置步骤
1. 在程序界面输入API密钥
2. 点击"保存密钥"按钮
3. 密钥会被加密保存到本地
4. 下次启动程序会自动加载

### 安全说明
- API密钥使用base64编码存储
- 配置文件保存在用户目录下
- 建议定期更换API密钥
- 不要将配置文件分享给他人

## 错误处理

### 常见错误
1. **API密钥未配置**：请先配置有效的API密钥
2. **API密钥格式错误**：确保密钥以"sk-"开头
3. **文件不存在**：检查PDF文件路径是否正确
4. **网络连接失败**：检查网络连接和API密钥
5. **文件格式错误**：确保文件是有效的PDF格式
6. **权限不足**：确保有读写目录的权限

### 错误信息
- 错误信息会显示在Excel的"备注"列中
- 错误行使用红色背景标识
- 包含具体的文件名称和错误原因

## 性能优化

### 缓存机制
- 首次处理文件会调用AI接口
- 重复处理相同文件会使用缓存
- 缓存文件可以手动删除以重新解析

### 批量处理
- 支持同时处理多个PDF文件
- 单个文件失败不影响其他文件
- 可以随时中断和重新开始

## 注意事项

### 数据准确性
- AI识别结果可能不准确
- 建议人工复核重要数据
- 特别是金额、税率等关键信息

### 文件管理
- 不要删除缓存文件（cache_res_*.json）
- 定期清理不需要的缓存文件
- 备份重要的Excel结果文件
- 时间戳文件名便于区分不同批次的处理结果

### 网络要求
- 首次处理需要网络连接
- 需要有效的DeepSeek API密钥
- 建议在稳定的网络环境下使用

### 安全要求
- 妥善保管API密钥
- 不要将密钥硬编码在代码中
- 定期更换API密钥
- 监控API使用量

## 故障排除

### 程序无法启动
1. 检查Python环境是否正确安装
2. 确认所有依赖包已安装
3. 检查API密钥配置

### 处理失败
1. 检查PDF文件是否损坏
2. 确认网络连接正常
3. 验证API密钥是否有效
4. 查看日志中的具体错误信息

### 结果不准确
1. 检查PDF文件质量
2. 确认发票格式是否标准
3. 人工复核重要数据

## 技术支持

如果遇到问题，请：
1. 查看程序日志中的错误信息
2. 检查README.md文档
3. 确认使用环境符合要求
4. 尝试重新处理或清除缓存
5. 验证API密钥配置

## 更新日志

### v1.0.2
- 增加API密钥配置功能
- 支持加密存储API密钥
- 自动加载已保存的API密钥
- 增强安全性，避免明文存储

### v1.0.1
- 增加Excel文件名时间戳功能
- 优化文件命名规则，便于区分不同批次的处理结果

### v1.0.0
- 初始版本发布
- 支持PDF发票识别
- 提供GUI界面
- 实现缓存机制
- 添加容错处理